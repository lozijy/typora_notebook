## 基于决策树的对英雄联盟游戏胜率的预测项目

### 数据:

来自于kaggle

![image-20221114194135465](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114194135465.png)

![image-20221114171018389](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114171018389.png)

### 1.了解数据的大致信息

```python
data.shape
```

![image-20221114171056795](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114171056795.png)

```python
data.describe()
```

![image-20221114171132349](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114171132349.png)

```python
data.head
```

![image-20221114171034310](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114171034310.png)

### 2.预处理

```python
labels=np.array(data["Winner"])
features=data.drop("Winner",axis=1)
feature_list=list(features.columns)
features=np.array(features)
```

### 3.查看特征之间的相关程度

绘制热力图

```python
corr = df.corr()
sns.heatmap(corr, 
            xticklabels=corr.columns.values,
            yticklabels=corr.columns.values)
```

进行 T-Test...



### 4.训练模型前需要先对数据集进行划分

```python
# 产生X, y，即特征值与目标值
target_name = 'Winner'
X = df.drop('Winner', axis=1)
y = df[target_name]

# 将数据分为训练和测试数据集
# 注意参数 stratify = y 意味着在产生训练和测试数据中, 离职的员工的百分比等于原来总的数据中的离职的员工的百分比
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.15, random_state=123, stratify=y)
# 显示前5行数据
df.head()
```

### 5.开始训练

```python
# 实例化
dtree = tree.DecisionTreeClassifier(
    criterion='entropy',
    #max_depth=3, # 定义树的深度, 可以用来防止过拟合
    min_weight_fraction_leaf=0.01 # 定义叶子节点最少需要包含多少个样本(使用百分比表达), 防止过拟合
    )
# 训练
dtree = dtree.fit(X_train,y_train)
# 指标计算
dt_roc_auc = roc_auc_score(y_test, dtree.predict(X_test))
print ("决策树 AUC = %2.2f" % dt_roc_auc)
print(classification_report(y_test, dtree.predict(X_test)))
```

![image-20221114193519287](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114193519287.png)

### 6.树模型的可视化

```python
from sklearn.tree import export_graphviz
import pydot
```

```python
export_graphviz(dtree,out_file="tree.dot",feature_names=feature_list,rounded=True,precision=1)
(graph,) = pydot.graph_from_dot_file("tree.dot")
graph.write_png("tree.png")
```

![image-20221114193657310](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114193657310.png)

![image-20221114193721652](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114193721652.png)

![image-20221114193738786](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221114193738786.png)



可以看到有多个分支

### 7.最后看看预测的效果

```python
true_data=pd.DataFrame(data={"id":[i for i in range(100)],"actual":y_test[:100]})
plt.plot(true_data["id"],y_test[:100],"bp",label="actual")
plt.plot(true_data["id"],dtree.predict(X_test)[:100],"rp",label="prediction")

plt.legend()
plt.xlabel("id")
plt.ylabel("blueWin")
plt.title("Actual and Predicted Values")
plt.show()

```



### 8.用户输入

```python
lis = ['blueFirstBlood'
                 ,'blueKills'
                 ,'blueDeaths'
                 ,'blueAssists'
                 ,'blueEliteMonsters'
                 ,'blueDragons'
                 ,'blueHeralds'
                 ,'blueTowersDestroyed'
                 ,'blueTotalGold'
                 ,'blueTotalMinionsKilled'
                 ,'redAssists'
                 ,'redEliteMonsters'
                 ,'redDragons'
                 ,'redHeralds'
                 ,'redTowersDestroyed'
                 ,'redTotalGold'
                 ,'redTotalMinionsKilled']
lol_data = []
for i in range(17):
    print("Please Iuput " + lis[i] + " : ", end='')
    s = int(input())
    lol_data.append([s])

lol_data = np.array(lol_data)
header = np.array(lis)
with open('lol.csv', 'w', newline='') as f:
    f_csv = csv.writer(f)
    f_csv.writerow(header)
    f_csv.writerows(lol_data.T)

want_data = pd.read_csv(r'lol.csv')

print()
if dtree.predict(want_data) == 1:
    print("BlueTeamWin, Probability: " + str(dtree.predict_proba(want_data)[0][1]))
else:
    print("BlueTeamLose, Probability: " + str(dtree.predict_proba(want_data)[0][0]))

import os

os.remove('lol.csv')

```

![image-20221115002141846](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221115002141846.png)

这是我们截取到的比赛第10min的画面，通过反复观看录像用人眼获取数据并输入:

![image-20221115002253380](C:\Users\lonux\AppData\Roaming\Typora\typora-user-images\image-20221115002253380.png)

最终得到T1决赛胜利的概率为百分之62(虽然最终还是输了)

## 不懂

roc_auc_score()

```python
dt_roc_auc = roc_auc_score(y_test, dtree.predict(X_test))
```



















